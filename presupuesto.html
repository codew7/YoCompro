<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yo Compro</title>

    <style>

        /* Para navegadores como Chrome, Safari y Edge */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
        }

        /* Estilos globales para la fuente y tamaño de letra */
        body, input, label, button, table, th, td {
            font-family: Arial, sans-serif;
            font-size: 14px; /* Puedes ajustar el tamaño según prefieras */
        }

        label {
            font-family: Arial, sans-serif;
            font-size: 14px; /* Puedes ajustar el tamaño según prefieras */
            font-weight: bold; /* Aplica negrita */
        }

        body { 
            background-color: #838282; 
            color: #333333; 
            text-align: center; 
        }
        .container { 
            background: white; 
            color: #333333; 
 
            margin: auto;   
            padding: 15px; 
            border-radius: 10px; 
            position: relative;
        }
        
        .header { 
            display: block;
            margin-bottom: 20px;
            text-align: left;
        }

        .header label {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .header label input {
            width: 100%;
            box-sizing: border-box;
        }

        .encabezado {
            text-align: left; /* Alinea el encabezado al centro */
            margin-bottom: 20px; /* Espacio debajo del encabezado */
            vertical-align: top;
        }

        .encabezado h1 {
            margin: 0;
        }

        .encabezado p {
            margin: 0;
            font-size: 14px;
        }

        .encabezado img {
            max-width: 90px; /* Ajusta el tamaño del logo */
            margin-right: 10px; /* Espacio a la derecha del logo */
            align-items: center;
        }

        .totals { 
            display: flex; 
            justify-content: flex-end; 
            flex-direction: column; 
            align-items: flex-end; 
            margin-top: 20px; 
        }
        .actions { 
            display: flex; 
            justify-content: right; 
            gap: 15px; 
            margin-top: 20px; 
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            table-layout: auto; /* Ajusta automáticamente el ancho de las columnas */
        }
        
        th, td { 
            border: 1px solid #d0d0d0; 
            padding: 10px; 
            text-align: center; 
            width: auto; /* Permite que el ancho se ajuste al contenido */
        }

        table td:nth-child(2) {
        text-align: left;
        }

        th:nth-child(1), td:nth-child(1) { 
            width: 5%; 
        }

        th:nth-child(2), td:nth-child(2) { 
            width: 65%; 
        }

        th:nth-child(3), td:nth-child(3) { 
            width: 15%; 
        }

        th:nth-child(4), td:nth-child(4) { 
            width: 15%; 
        }

        .cantidad, .articulo, .valor, .total, #descuento, #vendedor, #nombre {
            width: 100%; /* Ajusta el tamaño de los campos */
            padding: 1px; /* Espacio interno de los campos */
            margin: 1px 0; /* Espacio externo de los campos */
            box-sizing: border-box; /* Incluye el borde en el tamaño total */
            
        }

        /* Estilos específicos para los campos */
        #descuento { 
            width: auto;
            max-width: 40px;
        }

        #vendedor { 
            width: 35px; 
        }

        #formaPago {
            width: auto;
            min-width: 80px;
        }

        .articulo {
            text-align: left;
        }

        .whatsapp-icon {
        width: 22px;
        height: 22px;
        vertical-align: middle; /* Alinea la imagen con el texto */
        margin-right: 10px;
        }

        /* Estilos para impresión - formato recibo/factura adaptable */
        @media print {
            @page {
                size: auto;
                margin: 10mm;
            }

            * {
                box-sizing: border-box;
            }

            body {
                background-color: white;
                margin: 0;
                padding: 0;
                width: 100%;
            }

            .container {
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 10px;
                border-radius: 0;
                box-shadow: none;
                overflow: visible;
            }

            .encabezado {
                text-align: center;
                margin-bottom: 10px;
                border-bottom: 1px dashed #666;
                padding-bottom: 10px;
                overflow: visible;
            }

            .encabezado h3 {
                font-size: 16px;
                margin: 5px 0;
                text-align: left;
            }

            .encabezado p {
                font-size: 11px;
                margin: 2px 0;
            }

            #fecha {
                text-align: left;
                margin: 5px 0;
            }

            .encabezado img {
                max-width: 60px;
            }

            .encabezado > div:first-child {
                text-align: right !important;
                overflow: visible;
            }

            .encabezado > div {
                overflow: visible;
            }

            .header {
                margin-bottom: 10px;
                border-bottom: 1px dashed #666;
                padding-bottom: 8px;
                width: 100%;
                overflow: visible;
            }

            .header label {
                font-size: 12px;
                display: block;
                word-wrap: break-word;
            }

            /* Ocultar inputs y mostrar solo valores en impresión */
            input {
                border: none;
                background: transparent;
                padding: 0;
                font-size: 11px;
                font-weight: normal;
                width: auto !important;
                max-width: 100%;
            }

            label {
                font-size: 11px;
            }

            table {
                font-size: 11px;
                margin-top: 5px;
                width: 100%;
                table-layout: fixed;
                border-collapse: collapse;
            }

            th, td {
                padding: 5px 2px;
                font-size: 11px;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            /* Ajustar anchos de columnas para evitar desbordamiento */
            th:nth-child(1), td:nth-child(1) {
                width: 10% !important;
                text-align: center !important;
            }

            td:nth-child(1) input {
                text-align: center !important;
            }

            th:nth-child(2), td:nth-child(2) {
                width: 50%;
                text-align: left !important;
            }

            th:nth-child(3), td:nth-child(3) {
                width: 20% !important;
                text-align: center !important;
            }

            td:nth-child(3) input {
                text-align: center !important;
            }

            th:nth-child(4), td:nth-child(4) {
                width: 20%;
            }

            th {
                background-color: #e8e8e8;
            }

            .totals {
                margin-top: 10px;
                border-top: 1px dashed #666;
                padding-top: 10px;
                font-size: 12px;
                width: 100%;
                overflow: visible;
                text-align: right;
            }

            .totals label {
                font-size: 12px;
                margin: 3px 0;
                display: block !important;
                text-align: right !important;
                width: 100% !important;
            }

            .totals label input {
                text-align: right !important;
            }

            #formaPago {
                display: inline !important;
                border: none;
                background: transparent;
                font-size: 12px;
            }

            /* Ocultar botones y elementos no necesarios en impresión */
            .actions,
            button {
                display: none !important;
            }

            .whatsapp-icon {
                display: none;
            }

            /* Ajustar totales para formato recibo */
            #subtotal, #descuento, #totalFinal {
                font-weight: bold;
            }
        }

    </style>
</head>
<body>
    <div class="container" id="presupuesto">
        
        <div class="encabezado">
            <div style="text-align: center;">
                <img src="logo.png" alt="Logo">
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; vertical-align: middle;">
            <h3>Presupuesto</h3>
            <p>Tel. 266 4328198  <img src="whatsapp.png" alt="WhatsApp" class="whatsapp-icon"></p>
            </div>

            <p id="fecha"></p>
                
        </div>
        

        <div class="header">
            <label>Nombre: <input type="text" id="nombre"></label>
            <label>Domicilio: <input type="text" id="domicilio"></label>
            <label>Teléfono: <input type="text" id="telefono"></label>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Cant</th>
                    <th>Artículo</th>
                    <th>ValorU.</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="items">
                <tr>
                    <td><input type="number" class="cantidad" oninput="calcularTotales()"></td>
                    <td><input type="text" class="articulo"></td>
                    <td><input type="number" class="valor" oninput="calcularTotales()"></td>
                    <td class="total">$0</td>
                </tr>
            </tbody>
        </table>
      <br>
        <button onclick="agregarFila()">Agregar Artículo</button>
        <div class="totals">
            <label>Subtotal: $<span id="subtotal">0</span></label>
        <br>
            <label>Descuento: $ <input type="number" id="descuento" value="0" oninput="calcularTotales()"></label>
        <br>
            <label>Total Final: $<span id="totalFinal">0</span></label>
        <br>
            <label>Forma Pago: 
                <select id="formaPago">
                    <option value="Efectivo">Efectivo</option>
                    <option value="MercadoPago">MercadoPago</option>
                </select>
            </label>
        <br>
        </div>
        <div class="actions">
            <button onclick="compartirPresupuesto()">Compartir</button>
            <button onclick="nuevoPresupuesto()">Nuevo</button>
        </div>
    </div>
    
    <script>
        // Obtener la fecha actual
        const fechaActual = new Date();

        // Formatear la fecha en formato: día mes año
        const opciones = { year: 'numeric', month: 'long', day: 'numeric' };
        const fechaFormateada = fechaActual.toLocaleDateString('es-ES', opciones);

        // Mostrar la fecha en el elemento con id "fecha"
        document.getElementById('fecha').innerText = fechaFormateada;

        function calcularTotales() {
            let subtotal = 0;
            document.querySelectorAll('#items tr').forEach(row => {
                let cantidad = parseInt(row.querySelector('.cantidad').value) || 0;
                let valor = parseInt(row.querySelector('.valor').value) || 0;
                let total = cantidad * valor;
                row.querySelector('.total').innerText = `$${total.toLocaleString('es-ES')}`;
                subtotal += total;
            });
            document.getElementById('subtotal').innerText = subtotal.toLocaleString('es-ES');
            let descuento = parseInt(document.getElementById('descuento').value) || 0;
            document.getElementById('totalFinal').innerText = (subtotal - descuento).toLocaleString('es-ES');
        }

        function agregarFila() {
            let fila = `<tr>
                <td><input type="number" class="cantidad" oninput="calcularTotales()"></td>
                <td><input type="text" class="articulo"></td>
                <td><input type="number" class="valor" oninput="calcularTotales()"></td>
                <td class="total">$0</td>
            </tr>`;
            document.getElementById('items').insertAdjacentHTML('beforeend', fila);
        }

        async function compartirPresupuesto() {
            // Cargar jsPDF dinámicamente
            if (!window.jsPDF) {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                document.head.appendChild(script);
                
                await new Promise((resolve) => {
                    script.onload = resolve;
                });
            }
            
            const { jsPDF } = window.jspdf;
            
            // Configurar PDF para tamaño A6 (100x150mm)
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: [100, 150]  // A6: 100x150mm
            });
            
            // Configurar fuente
            pdf.setFont('helvetica', 'normal');
            pdf.setFontSize(8);
            
            let yPos = 10;
            const leftMargin = 5;
            const rightMargin = 95;
            const lineHeight = 3;
            
            // Encabezado
            pdf.setFontSize(10);
            pdf.text('Yo Compro', leftMargin, yPos);
            yPos += lineHeight;
            
            pdf.setFontSize(7);
            pdf.text('Tel. 266 4328198', leftMargin, yPos);
            yPos += lineHeight + 2;
            
            // Título Presupuesto y Fecha
            pdf.setFontSize(9);
            pdf.text('PRESUPUESTO', leftMargin, yPos);
            
            const fechaElement = document.getElementById('fecha');
            pdf.text(fechaElement.innerText, rightMargin, yPos, { align: 'right' });
            yPos += lineHeight + 3;
            
            // Línea separadora
            pdf.line(leftMargin, yPos, rightMargin, yPos);
            yPos += 3;
            
            // Datos del cliente
            pdf.setFontSize(7);
            const nombre = document.getElementById('nombre').value;
            const domicilio = document.getElementById('domicilio').value;
            const telefono = document.getElementById('telefono').value;
            
            if (nombre) {
                pdf.text(`Nombre: ${nombre}`, leftMargin, yPos);
                yPos += lineHeight;
            }
            if (domicilio) {
                pdf.text(`Domicilio: ${domicilio}`, leftMargin, yPos);
                yPos += lineHeight;
            }
            if (telefono) {
                pdf.text(`Teléfono: ${telefono}`, leftMargin, yPos);
                yPos += lineHeight;
            }
            yPos += 2;
            
            // Línea separadora
            pdf.line(leftMargin, yPos, rightMargin, yPos);
            yPos += 3;
            
            // Encabezados de tabla
            pdf.setFontSize(7);
            pdf.text('Cant', leftMargin, yPos);
            pdf.text('Artículo', leftMargin + 12, yPos);
            pdf.text('Valor U.', leftMargin + 55, yPos);
            pdf.text('Total', leftMargin + 75, yPos);
            yPos += 3;
            
            // Línea bajo encabezados
            pdf.line(leftMargin, yPos, rightMargin, yPos);
            yPos += 2;
            
            // Items de la tabla
            const filas = document.querySelectorAll('#items tr');
            filas.forEach(fila => {
                const cantidad = fila.querySelector('.cantidad').value || '0';
                const articulo = fila.querySelector('.articulo').value || '';
                const valor = fila.querySelector('.valor').value || '0';
                const total = fila.querySelector('.total').innerText || '$0';
                
                if (cantidad !== '0' || articulo !== '') {
                    pdf.text(cantidad, leftMargin, yPos);
                    
                    // Dividir texto largo del artículo si es necesario
                    const maxWidth = 40;
                    const articuloLines = pdf.splitTextToSize(articulo, maxWidth);
                    pdf.text(articuloLines, leftMargin + 12, yPos);
                    
                    pdf.text(`$${parseInt(valor).toLocaleString('es-ES')}`, leftMargin + 55, yPos);
                    pdf.text(total, leftMargin + 75, yPos);
                    
                    yPos += Math.max(3, articuloLines.length * 3);
                }
            });
            
            yPos += 2;
            
            // Línea separadora antes de totales
            pdf.line(leftMargin, yPos, rightMargin, yPos);
            yPos += 3;
            
            // Totales
            pdf.setFontSize(7);
            const subtotal = document.getElementById('subtotal').innerText;
            const descuento = document.getElementById('descuento').value || '0';
            const totalFinal = document.getElementById('totalFinal').innerText;
            const formaPago = document.getElementById('formaPago').value;
            
            pdf.text(`Subtotal: $${subtotal}`, leftMargin + 30, yPos);
            yPos += lineHeight;
            
            if (parseInt(descuento) > 0) {
                pdf.text(`Descuento: $${parseInt(descuento).toLocaleString('es-ES')}`, leftMargin + 30, yPos);
                yPos += lineHeight;
            }
            
            pdf.setFontSize(8);
            pdf.text(`TOTAL: $${totalFinal}`, leftMargin + 30, yPos);
            yPos += lineHeight + 1;
            
            pdf.setFontSize(7);
            pdf.text(`Forma de Pago: ${formaPago}`, leftMargin + 30, yPos);
            
            // Generar nombre del archivo con fecha y hora
            const ahora = new Date();
            const fechaArchivo = ahora.toLocaleDateString('es-ES').replace(/\//g, '-');
            const horaArchivo = ahora.toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'}).replace(/:/g, '');
            const nombreArchivo = `presupuesto_${fechaArchivo}_${horaArchivo}.pdf`;
            
            // Descargar el PDF
            pdf.save(nombreArchivo);
        }

        function nuevoPresupuesto() {
            document.getElementById('nombre').value = "";
            document.getElementById('domicilio').value = "";
            document.getElementById('telefono').value = "";
            document.getElementById('descuento').value = 0;
            document.getElementById('formaPago').value = "Efectivo";
            document.getElementById('subtotal').innerText = 0;
            document.getElementById('totalFinal').innerText = 0;
            document.getElementById('items').innerHTML = `<tr>
                <td><input type="number" class="cantidad" oninput="calcularTotales()"></td>
                <td><input type="text" class="articulo"></td>
                <td><input type="number" class="valor" oninput="calcularTotales()"></td>
                <td class="total">$0</td>
            </tr>`;
        }

    </script>
</body>
</html>